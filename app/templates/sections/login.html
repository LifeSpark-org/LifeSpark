<section id="login">
    <div class="auth-container">
        <div id="loginSection" class="auth-form-container">
            <div class="auth-header">
                <h2 data-translate="login-title">Login</h2>
                <p data-translate="login-subtitle">Welcome back to lifeSpark</p>
            </div>
            
            <form id="loginForm" class="auth-form" autocomplete="off">
                <div class="form-group">
                    <label for="loginEmail" data-translate="login-email">Email:</label>
                    <div class="input-with-icon">
                        <input type="email" id="loginEmail" required autocomplete="off">
                        <i class="fas fa-envelope input-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="loginPassword" data-translate="login-password">Password:</label>
                    <div class="input-with-icon">
                        <input type="password" id="loginPassword" required autocomplete="off">
                        <i class="fas fa-lock input-icon"></i>
                    </div>
                    <div class="password-options">
                        <label class="remember-me">
                            <input type="checkbox" id="rememberMe">
                            <span data-translate="login-remember">Remember me</span>
                        </label>
                        <a href="#" class="forgot-password" data-translate="login-forgot">Forgot password?</a>
                    </div>
                </div>

                <!-- reCAPTCHA Container - עודכן עם explicit rendering -->
                <div class="form-group captcha-container">
                    <div id="login-recaptcha" class="g-recaptcha"></div>
                    <div class="captcha-error" id="loginCaptchaError" style="display: none; color: red;">
                        <small data-translate="login-captcha-error">Please complete the captcha</small>
                    </div>
                </div>

                <button type="submit" data-translate="login-button">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
            
            <div class="social-login">
                <p data-translate="login-or">Or login with</p>
                <div class="social-buttons">
                    <button class="social-button" aria-label="Google">
                        <i class="fab fa-google"></i>
                    </button>
                    <button class="social-button" aria-label="Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </button>
                    <button class="social-button" aria-label="Apple">
                        <i class="fab fa-apple"></i>
                    </button>
                </div>
            </div>
            
            <div class="auth-switch">
                <p>
                    <span data-translate="login-no-account">Don't have an account?</span>
                    <button id="showRegisterButton" class="switch-button" data-translate="login-register-link">Register here</button>
                </p>
            </div>
        </div>

        <div id="registerSection" class="auth-form-container" style="display: none;">
            <div class="auth-header">
                <h2 data-translate="register-title">Register</h2>
                <p data-translate="register-subtitle">Join the lifeSpark community</p>
            </div>
            
            <form id="registerForm" class="auth-form" autocomplete="off">
                <div class="form-group">
                    <label for="registerName" data-translate="register-name">Name:</label>
                    <div class="input-with-icon">
                        <input type="text" id="registerName" required autocomplete="off">
                        <i class="fas fa-user input-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="registerEmail" data-translate="register-email">Email:</label>
                    <div class="input-with-icon">
                        <input type="email" id="registerEmail" required autocomplete="off">
                        <i class="fas fa-envelope input-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="registerPassword" data-translate="register-password">Password:</label>
                    <div class="input-with-icon">
                        <input type="password" id="registerPassword" required autocomplete="off">
                        <i class="fas fa-lock input-icon"></i>
                    </div>
                    <div class="password-strength">
                        <div class="strength-meter">
                            <div class="strength-segment"></div>
                            <div class="strength-segment"></div>
                            <div class="strength-segment"></div>
                            <div class="strength-segment"></div>
                        </div>
                        <span class="strength-text">Password strength</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="terms-checkbox">
                        <input type="checkbox" id="acceptTerms" required>
                        <label for="acceptTerms" data-translate="register-terms">I agree to the <a href="#" class="terms-link">Terms of Service</a> and <a href="#" class="terms-link">Privacy Policy</a></label>
                    </div>
                </div>

                <!-- reCAPTCHA Container - עודכן עם explicit rendering -->
                <div class="form-group captcha-container">
                    <div id="register-recaptcha" class="g-recaptcha"></div>
                    <div class="captcha-error" id="registerCaptchaError" style="display: none; color: red;">
                        <small data-translate="register-captcha-error">Please complete the captcha</small>
                    </div>
                </div>

                <button type="submit" data-translate="register-button">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </form>
            
            <div class="social-login">
                <p data-translate="register-or">Or register with</p>
                <div class="social-buttons">
                    <button class="social-button" aria-label="Google">
                        <i class="fab fa-google"></i>
                    </button>
                    <button class="social-button" aria-label="Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </button>
                    <button class="social-button" aria-label="Apple">
                        <i class="fab fa-apple"></i>
                    </button>
                </div>
            </div>
            
            <div class="auth-switch">
                <p>
                    <span data-translate="register-has-account">Already have an account?</span>
                    <button id="showLoginButton" class="switch-button" data-translate="register-login-link">Login here</button>
                </p>
            </div>
        </div>
    </div>

    <!-- reCAPTCHA Script - מעודכן לטעינה מפורשת יותר -->
    <script src="https://www.google.com/recaptcha/api.js?onload=initRecaptcha&render=explicit" async defer></script>
    <script>
        function initRecaptcha() {
            var siteKey = "{{ config.RECAPTCHA_SITE_KEY }}";
            console.log("Initializing reCAPTCHA with site key:", siteKey);  // בדיקת לוג
            
            // נסה לאתחל את ה-reCAPTCHA
            try {
                if (document.getElementById('login-recaptcha')) {
                    grecaptcha.render('login-recaptcha', {
                        'sitekey': siteKey,
                        'callback': function(response) {
                            console.log("reCAPTCHA response received");  // בדיקת לוג
                            document.getElementById('loginCaptchaError').style.display = 'none';
                        }
                    });
                }
                
                if (document.getElementById('register-recaptcha')) {
                    grecaptcha.render('register-recaptcha', {
                        'sitekey': siteKey,
                        'callback': function(response) {
                            document.getElementById('registerCaptchaError').style.display = 'none';
                        }
                    });
                }
            } catch (e) {
                console.error("reCAPTCHA initialization error:", e);
            }
        }
    </script>
</section>